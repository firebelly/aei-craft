{% extends (craft.app.request.isAjax and not craft.request.isLivePreview) ? "_ajax-layout" : "_layout" %}

{% block content %}

  {% for pageHeader in entry.pageHeader.all() %}
    {% include '/partials/_theater-header' %}
  {% endfor %}

  {% set rowNumber = 0 %}
  {% for block in entry.featureBlocks.all() %}
    {% switch block.type %}
      {% case "project" %}

        {% set rowNumber = rowNumber + 1 %}

        {% set project = block.featuredProjects.orderBy('RAND()')[0] ?? null %}
        {% if project %}

          {% set projectColor = (project.colorSwatch.label ?? 'black')|lower %}

          <div class="row -halves {{ cycle(['','-flip-order-md'],rowNumber) }}">
            <div class="row-block">
              <div class="module image-wrap -landscape -portrait-md">
                {% set image = project.projectImage.one() %}
                {% if image %}
                   <div class="image lazy" style="background-image: url('');" data-original="{{ image.getUrl('header') }}"></div>
                {% endif %}
              </div>
            </div>
            <div class="row-block">
              <div class="module text-module background-{{ projectColor }} text-off-white font-smoothing">
                <p class="font-h1">{{ project.projectTagline }}</p>
                <div class="buttons">
                  <a class="button" href="{{ project.url }}">
                    <span class="border"></span><span class="extra-corners"></span>
                    View Project
                    <svg class="icon icon-right-arrow"><use xlink:href="#icon-right-arrow" /></svg>
                  </a>
                </div>
              </div>
            </div>
          </div>

        {% endif %}

      {% case "feature" %}

        {% set rowNumber = rowNumber + 1 %}

        <div class="row -halves {{ cycle(['','-flip-order-md'],rowNumber) }}">
          <div class="row-block">
            <div class="module image-wrap -landscape -portrait-md">
              {% set image = block.featureImage.one() %}
              {% if image %}
                 <div class="image lazy" style="background-image: url('');" data-original="{{ image.getUrl('header') }}"></div>
              {% endif %}
            </div>
          </div>
          <div class="row-block">
            <div class="module text-module background-{{ cycle(['off-white','black'],rowNumber) }} text-{{ cycle(['black','off-white'],rowNumber) }} font-smoothing">
              <p class="font-h1">{{ block.featureHeadline }}</p>
              <div class="buttons">
                <a class="button" href="{{ block.featureLink }}">
                  <span class="border"></span><span class="extra-corners"></span>
                  {{ block.featureLinkLabel }}
                  <svg class="icon icon-right-arrow"><use xlink:href="#icon-right-arrow" /></svg>
                </a>
              </div>
            </div>
          </div>
        </div>

      {% case "impact" %}

        <ul class="row -halves -separators semantic-only-list">
          {% for post in block.impactPosts.all() %}
            <li class="row-block background-white text-black separate">
              {% include 'impact/_article' %}
            </li>
          {% endfor %}
        </ul>

    {% endswitch %}
  {% endfor %}

{% endblock %}

