{% extends (craft.app.request.isAjax and not craft.request.isLivePreview) ? "_ajax-layout" : "_layout" %}

{% if category is defined %}

  {% paginate craft.entries({
    section: 'projects',
    relatedTo: category,
    with: [
    'services',
    'markets',
    'projectImage'
    ]
  }).limit(8) as paginationInfo, projectEntries %}

  {% set subheader = category.description %}

{% else %}

  {% paginate craft.entries({
    section: 'projects',
    with: [
      'services',
      'markets',
      'projectImage'
    ]
  }).limit(8) as paginationInfo, projectEntries %}

  {% set subheader = entry.description %}

{% endif %}

{% block filters %}
  <li class="filters-item {{ (category is not defined) ? 'current' : '' }}">
    <a href="/expertise/">All</a>
  </li>
  {% for cat in craft.categories.group('markets').all() %}
    <li class="filters-item {{ active(cat.url, 'url', 'current') }}">
      <a href="{{ cat.url }}">{{ cat.title }}</a>
    </li>
  {% endfor %}
{% endblock %}

{% block content %}

<!-- top row: project text and first project (wrapped so they can visually align) -->
  <div class="row -halves top-row">
    <div class="row-block">
      <div class="module text-module background-white text-black pull-h1-to-top">
        <div class="font-h1 user-content">{{ subheader }}</div>
        <div class="buttons">
          <button class="contacts-open button">
            <span class="border"></span><span class="extra-corners"></span>
            Contacts
            <svg class="icon icon-plus "><use xlink:href="#icon-plus" /></svg>
          </button>
          <a class="button" href="/awards/">
            <span class="border"></span><span class="extra-corners"></span>
            Awards
            <svg class="icon icon-right-arrow"><use xlink:href="#icon-right-arrow" /></svg>
          </a>
        </div>
      </div>
    </div>

    {% set project = projectEntries[0] %}
    {% if project %}
    <div class="row-block">
      {% include 'projects/_article' %}
    </div>
    {% endif %}
  </div>


  <!-- all of the rest of the projects in masonry -->
  <div class="masonry-grid">
    <div class="masonry-sizer"></div>
    <ul class="semantic-only-list">
      {% for project in projectEntries %}
        {% if loop.index > 1 %}
          <li class="masonry-item">
            {% include 'projects/_article' %}
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>

  <nav class="pagination">
    <ul>
      {% if paginationInfo.prevUrl %}
      <li class="prev">
        <a rel="prev" href="{{ paginationInfo.prevUrl }}">Previous Page</a>
      </li>
      {% endif %}
      {% if paginationInfo.nextUrl %}
      <li class="next">
        <a rel="next" href="{{ paginationInfo.nextUrl }}">Next Page</a>
      </li>
      {% endif %}
    </ul>
  </nav>

{% endblock %}
